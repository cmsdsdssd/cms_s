# Catalog 마스터 등록/수정 쉬운 설명서 (비개발자용)

- 작성일: 2026-02-17
- 대상: 코딩을 모르는 운영/관리 사용자
- 목적: "입력한 값이 어디에 저장되고", "어떻게 합산되는지"를 한 번에 이해하기

## 1. 한 줄 요약

Catalog에서 마스터를 저장하면,

1) 제품 기본 정보는 `cms_master_item`에 저장되고,
2) 흡수공임(예외/추가 금액)은 `cms_master_absorb_labor_item_v1`에 따로 저장됩니다.

즉, **기본 정보 + 예외정보(흡수공임)** 구조입니다.

---

## 2. 큰 그림 (아주 쉽게)

쇼핑몰 상품관리로 비유하면:

- `cms_master_item` = 상품 기본카드
  - 모델명, 재질, 기본 공임, 도금, 메모 같은 "기본값"
- `cms_master_absorb_labor_item_v1` = 추가비용 메모장
  - "이 모델은 특정 사유로 +5,000원" 같은 예외 항목

그래서 한 모델을 계산할 때는

- 기본카드 값을 먼저 보고,
- 메모장(흡수공임)의 추가 금액을 더합니다.

---

## 3. 화면에서 입력한 값은 어디로 가나?

## 3-1. 기본 정보(메인 폼)

아래 값들은 저장 시 `cms_master_item`으로 들어갑니다.

- 모델명, 카테고리, 재질
- 중량, 차감중량
- 기본/센터/보조 공임(판매/원가)
- 도금 판매/원가
- 원석 소스 기본값
- BUY 마진 프로파일
- 세팅부가마진, 원석부가마진
- 메모, 이미지 경로, 거래처

저장 흐름:

1. 화면 저장 버튼 클릭
2. 서버 API `/api/master-item` 호출
3. 최종적으로 `cms_master_item` 반영

## 3-2. 흡수공임(아코디언 섹션)

흡수공임에서 입력하는 값은 `cms_master_absorb_labor_item_v1`에 들어갑니다.

- 버킷(BASE_LABOR / STONE_LABOR / PLATING / ETC)
- 사유(reason)
- 금액(amount_krw)
- 수량곱 여부(is_per_piece)
- 공장 스코프(vendor)
- 우선순위(priority)
- 활성여부(is_active)
- 노트(note)

저장 흐름:

1. 흡수공임 추가/수정 버튼 클릭
2. 서버 API `/api/master-absorb-labor-items` 호출
3. `cms_master_absorb_labor_item_v1`에 upsert(있으면 수정, 없으면 생성)

---

## 4. 합산은 어떻게 되나?

## 4-1. 화면에서 바로 보이는 합계공임

드로어 안의 "합계공임"은 즉시 계산용입니다.

- 판매 합계공임
  - 기본공임 + (센터공임 x 센터수량) + (보조1공임 x 보조1수량) + (보조2공임 x 보조2수량)
- 원가 합계공임
  - 위와 같은 방식으로 원가 버전 계산

즉, 사용자가 숫자를 바꾸면 화면 합계가 바로 바뀝니다.

## 4-2. 백엔드 엔진의 최종 합산

실제 엔진 계산에서는 추가 마진을 여러 항목으로 합산합니다.

- 룰 기반 마진들
- addon 마진(세팅부가마진, 원석부가마진)
- absorb 마진(흡수공임 항목들)

중요: **addon과 absorb는 현재 별도 항목으로 둘 다 더해집니다.**

---

## 5. "세팅부가마진/원석부가마진 = 흡수공임"인가?

현재 시스템 기준으로는 **아니오**입니다.

- 이유: 엔진에서 addon과 absorb를 따로 계산해 최종에 같이 더함
- 그래서 지금 addon을 바로 없애면, 기존 품목 가격이 바뀔 위험이 있음

운영 관점 해석:

- addon = 모델 기본 정책성 추가마진
- absorb = 사유 기반 예외성 추가마진

---

## 6. 새 마스터 등록과 마스터 수정 차이

## 6-1. 새 마스터 등록

- 빈 폼에서 시작
- 저장하면 새 `master_id`가 생성됨
- 그 다음부터 흡수공임을 붙일 수 있음

## 6-2. 마스터 수정

- 기존 값이 폼에 채워져 열림
- 저장하면 같은 `master_id`를 업데이트
- 흡수공임 목록도 함께 조회되어 수정 가능

---

## 7. 최근 UI 개선 반영

요청사항에 따라 흡수공임 영역은 기본 접힘으로 변경되었습니다.

- 기본 상태: 접힘
- 필요할 때만 펼쳐서 입력
- 목적: 화면 복잡도 감소

---

## 8. 실무 체크포인트

1. 가격이 갑자기 달라졌다면
   - 흡수공임 항목(활성/비활성, 금액, 수량곱 여부) 먼저 확인
2. 모델별 정책성 마진을 쓰고 있다면
   - addon 값(세팅/원석 부가마진)도 영향 있음
3. 특정 공장에만 다른 금액을 적용하려면
   - 흡수공임에서 vendor scope를 사용

---

## 9. 한 장으로 끝내는 데이터 흐름

`Catalog 화면 입력` -> `API 호출` -> `DB 저장` -> `엔진 합산`

- 기본 폼 -> `/api/master-item` -> `cms_master_item`
- 흡수공임 폼 -> `/api/master-absorb-labor-items` -> `cms_master_absorb_labor_item_v1`
- 엔진 -> addon + absorb 포함해 최종 추가마진 계산
