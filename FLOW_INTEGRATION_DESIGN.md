# 업무 흐름(Flow) 통합 설계안

## 🎯 핵심 진단: "흐름이 끊긴다"는 의미

### 현재 시스템의 단절 지점

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  주문 입력   │     │  주문 관리   │     │  출고 입력   │     │   미수금    │
│  /orders    │ ──▶ │ /orders_main│ ──▶ │ /shipments  │ ──▶ │    /ar     │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
       │                   │                   │                   │
       │                   │                   │                   │
       ▼                   ▼                   ▼                   ▼
   거래처 검색           거래처 검색         거래처 검색         거래처 검색
   (다시 입력)          (다시 입력)         (다시 입력)         (다시 입력)

❌ 문제: 같은 거래처 업무인데도 페이지마다 다시 검색
❌ 문제: 이전 작업의 맥락(context) 완전히 상실
❌ 문제: 주문→출고→미수가 별도의 "섬"처럼 떨어져 있음
```

### 데이터는 연결되어 있지만, UX는 연결되지 않음

**DB 관계 (연결됨)**:
```
Party ──▶ Order ──▶ Shipment ──▶ AR Ledger
```

**현재 UI (단절됨)**:
```
Party 선택 ▶ Order 페이지 ▶ Party 다시 선택 ▶ Shipment 페이지 ▶ Party 다시 선택 ▶ AR 페이지
```

---

## 🌊 해결책: "One Context Flow" (단일 맥락 흐름)

### 핵심 원칙
**"거래처 한 번 선택으로 모든 업무를 같은 화면에서 완료"**

### 새로운 흐름

```
┌─────────────────────────────────────────────────────────────────┐
│ 🔍 거래처: 금거래처A  ▼                    현재 미수: ₩150만   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ 📋 금거래처A 업무 타임라인                                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ [오늘]                                                          │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 📝 주문 #001                    10:23        [입력중]      │ │
│ │ BRACELET-001 × 10개              ₩2,500,000               │ │
│ │                                                             │ │
│ │ [✏️ 수정] [🚚 출고처리] [❌ 취소]                          │ │
│ │      ↓ 클릭 시 확장 (같은 페이지!)                          │ │
│ │ ┌─────────────────────────────────────────────────────────┐ │ │
│ │ │ 📦 출고 정보 입력                                      │ │ │
│ │ │ 중량: [10.5]g  차감: [0.5]g  공임: [150,000]₩          │ │ │
│ │ │                                                        │ │ │
│ │ │ [💾 임시저장]  [✅ 출고확정]                           │ │ │
│ │ └─────────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ ✅ 출고 #S01                    09:15        [완료]        │ │
│ │ RING-002 × 5개                   ₩1,250,000               │ │
│ │                                                             │ │
│ │ [🔄 반품처리] [💰 수금등록] [📄 출력]                      │ │
│ │      ↓ 클릭 시 확장                                        │ │
│ │ ┌─────────────────────────────────────────────────────────┐ │ │
│ │ │ 💵 수금 등록                                           │ │ │
│ │ │ 방법: [현금 ▼]  금액: [1,250,000]₩                     │ │ │
│ │ │                                                        │ │ │
│ │ │ [✅ 수금확정]                                          │ │ │
│ │ └─────────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ [어제]                                                          │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 💵 수금                         16:20        [완료]        │ │
│ │ ₩300,000 현금                                              │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  [+ 📝 주문추가]    [+ 💵 수금등록]    [+ 🔄 반품등록]         │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📱 화면 설계 상세

### 메인 뷰: 통합 작업대 (Workbench)

**URL**: `/workbench/:partyId`
**핵심**: 거래처를 선택하면 모든 업무를 여기서 완료

```typescript
// 상태 구조
interface WorkbenchState {
  // 1. 현재 선택된 거래처 (글로벌)
  currentParty: {
    id: string;
    name: string;
    balanceKrw: number;
    // ...
  };
  
  // 2. 타임라인 (모든 업무 통합)
  timeline: Array<{
    id: string;
    type: 'order' | 'shipment' | 'payment' | 'return';
    timestamp: Date;
    title: string;
    amount: number;
    status: 'pending' | 'completed' | 'cancelled';
    expanded: boolean;  // 확장 여부
    draft?: any;        // 임시 저장 데이터
  }>;
  
  // 3. 활성 작업 (현재 펼쳐진 입력 패널)
  activeWorkId: string | null;
}
```

**레이아웃**:
```
┌──────────────────────────────────────────────────────────────────┐
│ 💎 JewelOps                    🔍 금거래처A ▼    ₩150만   🔔 3  │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │  📋 업무 타임라인                              [필터 ▼]   │ │
│  ├────────────────────────────────────────────────────────────┤ │
│  │                                                            │ │
│  │  [오늘] ▼                                                  │ │
│  │  ┌────────────────────────────────────────────────────────┐│ │
│  │  │ 📝 주문 #001                    10:23        [입력중] ││ │
│  │  │ BRACELET-001 × 10개              ₩2,500,000          ││ │
│  │  │                                                        ││ │
│  │  │ [✏️ 수정]  [🚚 출고처리]  [❌ 취소]                    ││ │
│  │  └────────────────────────────────────────────────────────┘│ │
│  │                                                            │ │
│  │  ┌────────────────────────────────────────────────────────┐│ │
│  │  │ ✅ 출고 #S01                    09:15        [완료]   ││ │
│  │  │ RING-002 × 5개                   ₩1,250,000          ││ │
│  │  │                                                        ││ │
│  │  │ [🔄 반품]  [💰 수금등록]  [📄 출력]                    ││ │
│  │  └────────────────────────────────────────────────────────┘│ │
│  │                                                            │ │
│  │  [어제] ▼                                                  │ │
│  │  ┌────────────────────────────────────────────────────────┐│ │
│  │  │ 💵 수금                         16:20        [완료]   ││ │
│  │  │ ₩300,000 현금                                         ││ │
│  │  └────────────────────────────────────────────────────────┘│ │
│  │                                                            │ │
│  ├────────────────────────────────────────────────────────────┤ │
│  │  [+ 📝 주문추가]    [+ 💵 수금등록]                       │ │
│  └────────────────────────────────────────────────────────────┘ │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

---

### 확장 패널: 인라인 작업 (Inline Work)

**핵심**: 페이지 이동 없이 같은 화면에서 작업 완료

#### 주문 입력 → 출고 처리 연결

```
┌─────────────────────────────────────────────────────────────────┐
│ 📝 주문 #001                                                    │
│ BRACELET-001 × 10개  |  금거래처A                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [기본 정보]         [출고 처리 ▼]         [완료]              │
│                                                                 │
│  모델: BRACELET-001                                            │
│  수량: 10개                                                    │
│  색상: P (핑크)                                                │
│  도금: Y                                                       │
│                                                                 │
│  ─────────────────────────────────────────────────────────────  │
│                                                                 │
│  📦 출고 정보 (같은 페이지에서 입력)                           │
│                                                                 │
│  중량:     [10.5] g                                            │
│  차감:     [0.5] g                                             │
│  순중량:   10.0 g                                              │
│                                                                 │
│  공임:     [150,000] ₩                                         │
│  소재비:   자동 계산됨                                          │
│  합계:     ₩2,650,000                                          │
│                                                                 │
│  [💾 임시저장]    [✅ 출고확정]                                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

▼ 출고확정 클릭 후

┌─────────────────────────────────────────────────────────────────┐
│ ✅ 출고 #S01                                                    │
│ BRACELET-001 × 10개  |  금거래처A  |  ₩2,650,000              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [기본 정보]         [출고 완료]           [미수/수금 ▼]       │
│                                                                 │
│  출고일: 2026-02-01                                             │
│  중량: 10.5g                                                    │
│  공임: ₩150,000                                                 │
│                                                                 │
│  ─────────────────────────────────────────────────────────────  │
│                                                                 │
│  💵 수금 등록 (미수: ₩2,650,000)                               │
│                                                                 │
│  방법:    [현금 ▼]                                             │
│  금액:    [2,650,000] ₩                                        │
│  메모:    [1월 분 수금]                                        │
│                                                                 │
│  [💾 임시저장]    [✅ 수금확정]                                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

### 네비게이션 구조 개선

#### 현재 (문제)
```
사이드바:
├── 주문 입력 (/orders)
├── 주문 관리 (/orders_main)  ← 주문과 분리됨
├── 출고 관리 (/shipments)    ← 또 다른 페이지
├── 미수금 (/ar)              ← 또 다른 페이지
├── 재고 관리 (/inventory)    ← 완전히 분리
└── ...
```

#### 개선안
```
사이드바:
├── 📋 업무 작업대 (/workbench)  ← 메인 업무
│   ├── 전체 타임라인
│   ├── 주문만 보기
│   ├── 출고만 보기
│   └── 미수만 보기
├── 📦 제품/재고 (/products)     ← 제품 중심
│   ├── 제품 목록
│   ├── 재고 현황
│   └── 발주 관리
├── 👥 거래처 (/parties)         ← 거래처 관리
├── 📊 통계/리포트 (/analytics)
└── ⚙️ 설정 (/settings)
```

---

## 🔧 구현 방식

### 상태 관리 (핵심)

```typescript
// 글로벌 컨텍스트 (모든 페이지 공유)
const useWorkContext = create<WorkContext>((set, get) => ({
  // 현재 선택된 거래처
  currentParty: null,
  
  // 거래처 선택 (모든 페이지에서 동일한 함수 사용)
  selectParty: (party) => {
    set({ currentParty: party });
    // 타임라인 자동 로드
    get().loadTimeline(party.id);
  },
  
  // 타임라인 데이터
  timeline: [],
  loadTimeline: async (partyId) => {
    const data = await fetchTimeline(partyId);
    set({ timeline: data });
  },
  
  // 작업 확장/축소
  expandedWorkId: null,
  expandWork: (id) => set({ expandedWorkId: id }),
  collapseWork: () => set({ expandedWorkId: null }),
  
  // 작업 완료 후 다음 단계로
  completeWork: (workId, nextType) => {
    // 1. 현재 작업 완료 표시
    const timeline = get().timeline.map(item =>
      item.id === workId ? { ...item, status: 'completed' } : item
    );
    set({ timeline });
    
    // 2. 다음 작업 자동 생성/확장
    const newWork = {
      id: generateId(),
      type: nextType,
      status: 'pending',
      expanded: true,
      // ...
    };
    set({ 
      timeline: [...timeline, newWork],
      expandedWorkId: newWork.id
    });
  }
}));
```

### 라우팅 구조

```typescript
// 현재
<Route path="/orders" component={OrdersPage} />
<Route path="/orders_main" component={OrdersMainPage} />
<Route path="/shipments" component={ShipmentsPage} />
<Route path="/ar" component={ARPage} />

// 개선
<Route path="/workbench/:partyId" component={WorkbenchPage} />
// 쿼리 파라미터로 뷰 전환: ?view=orders|shipments|payments|all
```

### 컴포넌트 구조

```typescript
// WorkbenchPage.tsx
function WorkbenchPage() {
  const { partyId } = useParams();
  const [view, setView] = useQueryParam('view', 'all');
  const { timeline, expandedWorkId, expandWork } = useWorkContext();
  
  return (
    <div className="workbench">
      {/* 거래처 헤더 (고정) */}
      <PartyHeader partyId={partyId} />
      
      {/* 뷰 전환 탭 */}
      <ViewTabs current={view} onChange={setView} />
      
      {/* 타임라인 */}
      <Timeline
        items={timeline}
        expandedId={expandedWorkId}
        onExpand={expandWork}
        renderItem={(item) => (
          <WorkItem
            key={item.id}
            data={item}
            expanded={item.id === expandedWorkId}
            renderExpanded={() => {
              // 작업 타입별 확장 패널
              switch (item.type) {
                case 'order':
                  return <OrderWorkPanel orderId={item.id} />;
                case 'shipment':
                  return <ShipmentWorkPanel shipmentId={item.id} />;
                case 'payment':
                  return <PaymentWorkPanel paymentId={item.id} />;
              }
            }}
          />
        )}
      />
      
      {/* 새 작업 추가 버튼 */}
      <AddWorkButton partyId={partyId} />
    </div>
  );
}
```

---

## 🎨 시각적 통일성

### 색상 시스템

```css
/* 업무 타입별 색상 - 모든 곳에서 동일하게 사용 */
--order-color: #3B82F6;        /* 파랑 */
--order-bg: #EFF6FF;

--shipment-color: #10B981;     /* 초록 */
--shipment-bg: #ECFDF5;

--payment-color: #8B5CF6;      /* 보라 */
--payment-bg: #F5F3FF;

--return-color: #EF4444;       /* 빨강 */
--return-bg: #FEF2F2;
```

### 아이콘 시스템

```typescript
// 모든 페이지에서 동일한 아이콘 사용
const WorkTypeIcons = {
  order: ClipboardList,      // 주문
  shipment: PackageCheck,    // 출고
  payment: CreditCard,       // 수금
  return: RotateCcw,         // 반품
  inventory: Package         // 재고
};
```

### 애니메이션

```typescript
// 작업 완료 → 다음 작업 연결 애니메이션
const WorkTransition = ({ completed, next }) => (
  <motion.div
    initial={{ opacity: 0, height: 0 }}
    animate={{ opacity: 1, height: 'auto' }}
    transition={{ type: "spring", stiffness: 300, damping: 30 }}
  >
    <CompletedWork data={completed} />
    <ConnectionArrow />
    <NextWorkPreview data={next} onClick={() => expandWork(next.id)} />
  </motion.div>
);
```

---

## 📊 구현 단계

### Phase 1: 코어 구축 (2주)
- [ ] 글로벌 상태 관리 시스템 (Zustand)
- [ ] 통합 거래처 헤더
- [ ] 타임라인 뷰 기본
- [ ] 인라인 확장 패널

### Phase 2: 업무 연결 (2주)
- [ ] 주문 → 출고 연결
- [ ] 출고 → 수금 연결
- [ ] 알림/할 일 시스템
- [ ] 임시저장 기능

### Phase 3: 고도화 (2주)
- [ ] 제품 통합 뷰
- [ ] 재고 연동
- [ ] 통계/리포트
- [ ] 모바일 최적화

---

## ✅ 성공 기준

### 사용자 경험
- [ ] 거래처 선택 후 페이지 이동 없이 주문→출고→미수 완료
- [ ] 이전 작업의 맥락(거래처, 제품, 금액)이 유지됨
- [ ] 전체 업무 흐름을 한 화면에서 파악 가능

### 정량적 지표
- [ ] 페이지 이동 횟수: 5회 → 0회
- [ ] 업무 완료 시간: 50% 단축
- [ ] 거래처 재검색: 0회

---

**핵심 메시지**: 

> **데이터는 이미 연결되어 있습니다.** 
> **이제 UI/UX도 같은 맥락으로 연결해야 합니다.**
> 
> "주문→출고→미수"가 하나의 **흐름(flow)**이 되어야 합니다.
